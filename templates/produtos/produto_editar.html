{% extends 'usuarios/perfil-principal.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}

<main class="col-md-9">

        <div class="card mb-4">
      <div class="card-body ">

          {% if not usuario.status %}
          <div>
              <h5 class="text-center mt-4">
                  <strong>
					 Você precisa realizar o cadastro de seu perfil para adicionar o seu produto
                  </strong>
                  <img src="{% static 'ecommerce/images/atencao.png' %}"/>
                  </h5>
					<div class="d-flex justify-content-center">

				<a href="{% url 'usuarios:criarperfil' %}" class="btn btn-secondary">Cadastrar produto</a>
					</div>
				</div>

				{% elif usuario.status %}

              <h4 class="card-title mb-5">
                {% if editar == 'editar' %}
                    Editar produto

                    {% else %}
                  Cadastrar produto
                    {% endif %}
                </h4>

          {% if messages %}
            {% for message in messages %}
                {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
                    <div class="alert alert-danger " role="alert">
                        {{ message }}
                    </div>
                {% endif %}
    {% endfor %}
{% endif %}

              <form  method="POST" autocomplete="off" enctype="multipart/form-data" >
                  {% csrf_token %}
                  <div class="form-row">
                      <div class="form-group col-md-6">
                        {{ form.nome|as_crispy_field }}
                      </div>
                      <div class="form-group col-md-6">
                        {{ form.preco|as_crispy_field }}

                      </div>
                  </div>

                               <div class="form-row">
                                   {% if not editar == 'editar' %}
                      <div class="form-group  col-md-6">

                            {{ form.imagem|as_crispy_field }}

                      </div>
                        {% endif %}

                  <div class="form-group  col-md-6">
                        {{ form.quantidade|as_crispy_field }}
                      </div>

                  <div class="form-group  col-md-6">
                      <label>Categoria*</label>

                        <select name="categoria" id="categoria" class="form-control" required>
                            <option value="" disabled selected hidden>Selecione sua categoria</option>
                            {% for indice, categoria in categorias.items %}
                                {% if categoria_produto.nome == categoria.name %}
                                  <option value="{{ categoria.id }}" selected>{{ categoria_produto.nome }}</option>
                                {% elif categoria.name == 'Mais Categorias' %}
                                   <option value="{{ categoria.id }}">Outras Categorias</option>
                                {% else %}
                                  <option value="{{ categoria.id }}">{{ categoria.name }}</option>

                                {% endif %}
                            {% endfor %}
                        </select>
                      <small id="hint_id_categoria" class="form-text text-muted">Obrigatório</small>

                      </div>

                                    <div class="form-group col-md-6">
                                   <label>Subcategoria  {{ subcategoria_produto.nome }} </label>
								<select id="subcategoria" name="subcategoria" class="form-control">
                                    {% if subcategoria_produto %}
                                      <option value="{{ subcategoria_produto.nome }}" selected>{{ subcategoria_produto.nome }}</option>
                                    {% else %}
                                        <option value="" disabled selected hidden>Selecione a subcategoria</option>
                                    {% endif %}
                                </select>
                                        <small id="hint_id_subcategoria" class="form-text text-muted">Não obrigatório</small>
                 </div>

                      <div class="form-group col-md-12">
                        {{ form.descricao|as_crispy_field }}
                      </div>
                                   <input  type="hidden"  name="campoIDProduto" value="{{ produto_id }}">
                  </div>

                  <div class="form-group">

                      <a href="{% url 'vitrines:minha_vitrine' %}" class="btn btn-secondary">Voltar para vitrine
                        <i class="fas fa-arrow-circle-left"></i>
                      </a>
                       <button type="submit" class="btn btn-primary"> Salvar </button>
                  </div>
              </form>
                  {% endif %}
      </div>
    </div>

</main>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script src="{% static 'js/carregarsubcategorias.js' %}" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.5/inputmask.js " type="text/javascript"></script>
<script src="{% static 'js/mascaraPreco.js' %}" type="text/javascript"></script>

<script>

  $("#id_preco").keyup(function() {
      return verificaNumero(this.value, "#id_preco");
  });

  $("#id_quantidade").keyup(function() {
    return verificaNumero(this.value, "#id_quantidade");
  });

  function verificaNumero(char, input) {
    if (char == ''){
      $(input).val($(input).slice(0, -1));
      return false;
    }
      return true;
  }

</script>


	{% if messages %}
		{% for m in messages %}
		<script>


			{% if m.level == DEFAULT_MESSAGE_LEVELS.ERROR %}

				const Toast = Swal.mixin({
				  toast: true,
				  position: 'center',
				  showConfirmButton: true,
				  timer: 3000,
				  timerProgressBar: true,
				  didOpen: (toast) => {
					toast.addEventListener('mouseenter', Swal.stopTimer)
					toast.addEventListener('mouseleave', Swal.resumeTimer)
				  }
				})

				Toast.fire({
				  icon: 'error',
				  title: '{{m}}'
				}).then((result) => {
				  if (result.isConfirmed) {
				  }
				})
				{% endif %}
		  </script>
		{% endfor %}
	{% endif %}

{% endblock %}
