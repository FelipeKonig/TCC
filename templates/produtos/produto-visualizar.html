{% extends 'ecommerce/base.html' %}
{% load static %}

{% block body %}

<body>
<form action="/pedidos/adicionar-produto-carrinho/"  method="post">
  {% csrf_token %}

<section class="py-3 bg-light">
  <div class="container">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'e-commerce:home' %}">Home</a></li>
        <li class="breadcrumb-item"><a href="#!">{{ produto.categoria }}</a></li>
        {% if produto.subCategoria %}
          <li class="breadcrumb-item"><a href="#!">{{ produto.subCategoria }}</a></li>
        {% endif %}
        <li class="breadcrumb-item active" aria-current="page">Items</li>
    </ol>
  </div>
</section>

<!-- ========================= SECTION CONTENT ========================= -->
<section class="section-content bg-white padding-y">
<div class="container">

<!-- ============================ ITEM DETAIL ======================== -->
<div class="row">
  <aside class="col-md-6">
    <div class="card">
      <article class="gallery-wrap">
          <div class="img-big-wrap">
              <div> <img id="img_principal" class="zoom img-fluid mx-auto d-block shadow"
                src="{{ primeira_imagem.imagem.url }}"></div>
          </div> <!-- slider-product.// -->
        <div class="thumbs-wrap">
          {% for foto in imagens_produto %}
              <img class="item-thumb" src="{{ foto.imagem.url }}">
          {% endfor %}
        </div> <!-- slider-nav.// -->
      </article> <!-- gallery-wrap .end// -->
    </div> <!-- card.// -->
  </aside>

<main id="info-produto" class="col-md-6">
  <article class="product-info-aside">

  <h2 class="title mt-3">{{ produto.nome }}</h2>

  <div class="rating-wrap my-3">
  	<ul class="rating-stars">
  		<li class="stars-active">
        {% for rating in nota %}
  			   <i class="fa fa-star"></i>
        {% endfor %}
  		</li>
  		<li>
  			<i class="fa fa-star"></i> <i class="fa fa-star"></i>
  			<i class="fa fa-star"></i> <i class="fa fa-star"></i>
  			<i class="fa fa-star"></i>
  		</li>
  	</ul>
    {% if avaliacao.quantidade == None %}
      <small class="label-rating text-muted">Sem avaliações</small>
    {% else %}
      {% if avaliacao.quantidade == 1 %}
        <small class="label-rating text-muted">{{ avaliacao.quantidade }} avaliação</small>
      {% else %}
        <small class="label-rating text-muted">{{ avaliacao.quantidade }} avaliações</small>
      {% endif %}
    {% endif %}

    {% if encomendas == 0 %}
  	 <small class="label-rating text-success"> <i class="fa fa-clipboard-check"></i> Sem encomendas </small>
    {% else %}
      {% if encomendas == 1 %}
        <small class="label-rating text-success"> <i class="fa fa-clipboard-check"></i> {{ encomendas }} encomenda </small>
      {% else %}
        <small class="label-rating text-success"> <i class="fa fa-clipboard-check"></i> {{ encomendas }} encomendas </small>
      {% endif %}
    {% endif %}
  </div> <!-- rating-wrap.// -->

  <div class="mb-3">
  	<var class="price h4">R$ {{ produto.preco }}</var>
  </div> <!-- price-detail-wrap .// -->
  <div class="mb-3">
  	<p>Vitrine: {{ vitrine.nome }}</p>
  </div> <!-- price-detail-wrap .// -->
  {% if vitrine.empresa %}
    <div class="mb-3">
    	<p><i class="fas fa-building"></i> &nbsp; Empresa: {{ vitrine.empresa.fantasia }}</p>
    </div> <!-- price-detail-wrap .// -->
  {% else %}
    <div class="mb-3">
    	<p><i class="fas fa-male"></i> &nbsp; Pessoa: {{ vitrine.vendedor.first_name }} {{ vitrine.vendedor.last_name }}</p>
    </div> <!-- price-detail-wrap .// -->
  {% endif %}

  <div class="card">
    <div class="card-body">
      <strong>Endereço do vendedor</strong>
      {% if endereco %}
        <div class="row">
          <div class="col-lg-6 mt-2">
            <p>Estado: {{ endereco.estado }}</p>
          </div>
          <div class="col-lg-6 mt-2">
            <p>Cidade: {{ endereco.cidade }}</p>
          </div>
          <div class="col-lg-6">
            <p>Bairro: {{ endereco.bairro }}</p>
          </div>
          <div class="col-lg-6">
            <p>Rua: {{ endereco.rua }}</p>
          </div>
          <div class="col-md-6">
            <p>Número: {{ endereco.numero }}</p>
          </div>
          <div class="col-md-6">
            <p>CEP: {{ endereco.cep }}</p>
          </div>
          <div class="col-sm">
            <p>complemento: {{ endereco.complemento }}</p>
          </div>
        </div>
        {% if enderecos %}
          <button type="button" class="btn btn-outline-secondary text-nowrap btn-sm mt-2" data-toggle="modal"
            data-target="#mostrarEnderecos">
            Ver outros endereços
          </button>
        {% endif %}
      {% else %}
        <div class="alert alert-warning mt-3">
          <p class="icontext"> O vendedor não possui um endereço </p>
        </div>
      {% endif %}
    </div>
  </div>
  <!-- </div> -->

  </article> <!-- product-info-aside .// -->
  {% if pedido.statusReservado %}
    <div class="card mt-2">
      <div class="card-body">
        <strong>Informações do pedido </strong>
        <div class="row">
          <div class="col-sm-12 mt-2">
            <p>Quantidade: {{ pedido.quantidade }}</p>
          </div>
          <div class="col-sm-12 mt-2">
            <p>Data de reserva: {{ pedido.dataCriacao }}</p>
          </div>
          <div class="col-sm-12 mt-2">
            {% if pedido.dataRetirada == None %}
              <p>Data de entrega: Produto ainda não entregue</p>
            {% else %}
              <p>Data de entrega: {{ pedido.dataRetirada }}</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <div class="product-info-aside child">
      <div class="form-row mt-2">
        <div class="form-group col-md flex-grow-0 mt-3">
          <div class="input-group mb-3 input-spinner">
            <div class="input-group-prepend">
              <button class="btn btn-light mt-3" type="button" id="button-minus"> &minus; </button>
            </div>
            <input name="quant_produto" id="quant_produto" type="number" class="form-control mt-3"
            min="1" value="1" max="{{ produto.quantidade }}" autocomplete="off" readonly>
            <div class="input-group-append">
              <button class="btn btn-light mt-3" type="button" id="button-plus"> + </button>
            </div>
          </div>
        </div> <!-- col.// -->
        {% if vendedor %}
          <div class="form-inline col-lg">
            <a href="#!" data-toggle="popover" data-content="Função indisponível para o vendedor" data-placement="bottom"
              class="btn btn-primary mt-1 ml-1">
              <i class="fas fa-shopping-cart"></i> <span class="text">Adicionar ao carrinho </span>
            </a>
            <a href="#!" data-toggle="popover" data-content="Função indisponível para o vendedor" data-placement="bottom"
              class="btn btn-light mt-1 ml-1">
              <i class="fas fa-envelope"></i> <span class="text">contate o vendedor</span>
            </a>
          </div> <!-- col.// -->
        {% else %}
          <div class="form-inline col-lg">
            <button name="produto" value="{{ produto.pk }}" type="submit" class="btn btn-primary mt-1 ml-1">
              <i class="fas fa-shopping-cart"></i> <span class="text">Adicionar ao carrinho </span>
            </button>
            &nbsp;
            <a href="#!" class="btn btn-light mt-1 ml-1">
              <i class="fas fa-envelope"></i> <span class="text">contate o vendedor</span>
            </a>
          </div> <!-- col.// -->
        {% endif %}
      </div> <!-- row.// -->
    </div>
  {% endif %}
  <div class="card mt-2">
    <div class="card-body">
      <strong>Telefone do vendedor</strong>
      <div class="row">
        <div class="col-sm-12 mt-2">
          <p>Telefone do vendedor: {{ telefone_padrao.numero }}</p>
        </div>
        {% if telefone_alternativo %}
          <div class="col-sm-12 mt-2">
            <p>Telefone alternativo do vendedor: {{ telefone_alternativo.numero }}</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

</main> <!-- col.// -->
</div> <!-- row.// -->

</form>

<!-- Modal -->
<div class="modal fade" id="mostrarEnderecos" tabindex="-1" role="dialog" aria-labelledby="modalEnderecos" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalEnderecos">Outros endereços</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
            {% for endereco in enderecos %}
              <div class="card mt-2">
                <div class="card-body">
                  <div class="row">
                    <div class="col-lg-6 mt-2">
                      <p>Estado: {{ endereco.estado }}</p>
                    </div>
                    <div class="col-lg-6 mt-2">
                      <p>Cidade: {{ endereco.cidade }}</p>
                    </div>
                    <div class="col-lg-6">
                      <p>Bairro: {{ endereco.bairro }}</p>
                    </div>
                    <div class="col-lg-6">
                      <p>Rua: {{ endereco.rua }}</p>
                    </div>
                    <div class="col-md-6">
                      <p>Número: {{ endereco.numero }}</p>
                    </div>
                    <div class="col-md-6">
                      <p>CEP: {{ endereco.cep }}</p>
                    </div>
                    <div class="col-sm">
                      <p>complemento: {{ endereco.complemento }}</p>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<!-- ================ ITEM DETAIL END .// ================= -->


</div> <!-- container .//  -->
</section>
<!-- ========================= SECTION CONTENT END// ========================= -->

<!-- ========================= SECTION  ========================= -->
<section class="section-name padding-y bg">
<div class="container">

<div class="row">
	<div class="col-md-8">
		<h5 class="title-description">Descrição</h5>
		<p>
			{{ produto.descricao }}
		</p>

		<h5 class="title-description">Especificações</h5>
    {% for caract in lista_caracteristicas %}
  		<table class="table table-bordered">
  			<tr> <th colspan="2">{{ caract.topico }}</th> </tr>
        {% for attr in lista_atributos %}
          {% if attr.caracteristica == caract %}
            <tr> <td>{{ attr.nome }}</td><td>{{ attr.descricao }}</td> </tr>
          {% endif %}
        {% endfor %}
  		</table>
    {% endfor %}
    {% if not lista_caracteristicas %}
      <p> Este produto não possui especificações </p>
    {% endif %}
	</div> <!-- col.// -->

	<aside class="col-md-4">

		<div class="box">

		<h5 class="title-description">Comentários</h5>
			<p>
				Ainda sem a função
			</p>

	</div> <!-- box.// -->
	</aside> <!-- col.// -->
</div> <!-- row.// -->

</div> <!-- container .//  -->
</section>

</body>

<style media="screen">
  #info-produto {
    display: flex;
    flex-direction: column;
  }
  .child {
    margin-bottom: auto;
    margin-top: auto;
  }
  /* Chrome, Safari, Edge, Opera */
  input::-webkit-outer-spin-button,
  input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  /* Firefox */
  input[type=number] {
    -moz-appearance: textfield;
  }
</style>

<script src="{% static 'js/visualizarProduto.js' %}" type="text/javascript"></script>

{% endblock %}
